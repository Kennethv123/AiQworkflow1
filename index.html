<!DOCTYPE html>
<html lang="en">
    <head>  
        <title> page </title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
       
        <link href="https://cdn.plyr.io/3.7.2/plyr.css" rel="stylesheet" />
        <link rel="stylesheet" href="style.css">

        <script src="https://cdn.jsdelivr.net/npm/@millicast/sdk@latest/dist/millicast.umd.js"></script>
        
       <p class="Header">
        Title
       </p>
    </head>
    <body> 
        <div class=MediaBox> 
            <div id="millicasttitle"> millicast demo</div>
            <div class="MainMediaBox">
                <video width=100% height=100% id="videoPlayer" controls class="vidBox"></video>
                <script>
                    let accID = "6d8srH";
                    let streamName = "myStreamName";
                    let video = document.getElementById("videoPlayer");
                    
                    const options = {
                        disableVideo: false,
                        disableAudio: false,
                        bandwidth: 0,
                    };

                    

                    const tokenGenerator = () =>
                        window.millicast.Director.getSubscriber({
                            streamName: streamName,
                            streamAccountId: accID,
                        });
                        

                    const millicastView = new window.millicast.View(streamName, tokenGenerator, null, true);
                    

                    millicastView.on("track", (event) => {
                        addStreamToYourVideoTag(event.streams[0]);
                    });
                    
                    try {
                        millicastView.connect(options);
                    } catch (e) {
                        millicastView.reconnect();
                    }

                    function addStreamToYourVideoTag(elem) {
                        let video = document.getElementById("videoPlayer");
                        video.srcObject = elem;
                        video.autoplay = true;
                    }

                </script>
            </div>
            <div class = "SideMediaBox">
                <div class="SidePlayer"></div>
                <div class="SidePlayer"></div>
                <div class="SidePlayer"></div>
            </div>
        </div> 
        
        <div class="MediaBoxHLS">
            <div id = "HLSdemo">HLS demo</div>
            <video controls id = "HlsVideo">
                <track kind = "subtitles" src="assets/1. Leo - Netflix - Source English with CC.vtt" srclang="en" label="English" default/>
            </video>
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    var HlsVideo = document.getElementById('HlsVideo');
                    var HlsVideoSrc = "assets/Master.m3u8";
                    const defaultOptions = {};

                    if (Hls.isSupported()) {
                        var hls = new Hls();
                        hls.loadSource(HlsVideoSrc);
                        hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
                            const availableQualities = hls.levels.map((l) => l.height)

                            defaultOptions.controls = 
                            [
                                'play-large', 
                                'restart', 
                                'rewind', 
                                'play', 
                                'fast-forward', 
                                'progress',
                                'current-time', 
                                'duration', 
                                'mute', 
                                'volume', 
                                'captions', 
                                'settings', 
                                'pip', 
                                'airplay', 
                                'fullscreen', 
                            ];
                            defaultOptions.quality = {
                                default: availableQualities[0],
                                options: availableQualities,
                                forced: true,
                                onChange: (e) => updateQuality(e)
                            }
                            new Plyr(HlsVideo, defaultOptions);
                        });
                        hls.attachMedia(HlsVideo);
                        window.hls = hls;
                    }
                    function updateQuality(newQuality) {
                        window.hls.levels.forEach((level, levelIndex) => {
                            if(level.height === newQuality){
                                window.hls.currentLevel = levelIndex
                            }
                        })
                    }
                })     
            </script>

            <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
            <script src="https://cdn.plyr.io/3.7.2/plyr.js"></script>
        </div>
        <footer>
            footer 
        </footer>
    </body>
</html>